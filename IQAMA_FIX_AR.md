# โณ ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุจุฏุก ุงูุนุฏ ุงูุชูุงุฒูู

## ๐ฏ ุงููุดููุฉ

- โ ุงูุฃุฐุงู ูุนูู ุจุดูู ููุชุงุฒ
- โ ุงูุนุฏ ุงูุชูุงุฒูู ููุฅูุงูุฉ **ูุง ูุจุฏุฃ** ุจุนุฏ ุงูุชูุงุก ุงูุฃุฐุงู

## ๐ ุงูุณุจุจ

ุงููุดููุฉ ูุงูุช ูู ุชุฏุงุฎู `event listener` ุงูุฎุงุต ุจุงูุชูุงุก ุงูุฃุฐุงู (`'ended'`) ูุน `useEffect` ุงูุฑุฆูุณู. ุนูุฏูุง ูุงู `useEffect` ูุนุงุฏ ุชุดุบูููุ ูุงู ูุชู ููุฏุงู ุงูู `listener`.

## โ ุงูุญู

ุชู **ูุตู ุงููุณุคูููุงุช**:

### 1. `useEffect` ูุฏุฎูู ุงูููุช (ุงูุณุทุฑ 456-473)
- **ูุณุคูููุชู:** ููุท ุชุญุฏูุฏ ููุช ุงูุตูุงุฉ ูุชุบููุฑ ุงููุฑุญูุฉ ุฅูู `'adhan'`.
- ูุง ูููุณ ุงูุตูุช ููุงุฆูุงู.

```javascript
// ูุฐุง ุงูู useEffect ูุฑุงูุจ ุงูููุช ููุท
useEffect(() => {
  if (currentPhase === 'idle' && isTimeForPrayer) {
    setActivePrayer(prayerName);
    setCurrentPhase('adhan');
  }
}, [nowTz, currentPhase]);
```

### 2. `useEffect` ูุชุดุบูู ุงูุฃุฐุงู (ุงูุณุทุฑ 397-436)
- **ูุณุคูููุชู:** ุนูุฏูุง ุชุชุบูุฑ `currentPhase` ุฅูู `'adhan'`ุ ูููู ุจุชุดุบูู ุงูุฃุฐุงู.
- ูุง ุนูุงูุฉ ูู ุจุงูููุช.

```javascript
// ูุฐุง ุงูู useEffect ูุฑุงูุจ ูุฑุญูุฉ ุงูุฃุฐุงู ููุท
useEffect(() => {
  if (currentPhase === 'adhan') {
    // ุชุดุบูู ุงูุฃุฐุงู
    audioRef.current.play();
  }
}, [currentPhase]);
```

### 3. `useEffect` ูุงูุชูุงุก ุงูุฃุฐุงู (ุงูุณุทุฑ 438-454)
- **ูุณุคูููุชู:** ุฅุถุงูุฉ `event listener` ูู `audioRef`.
- ุนูุฏูุง ููุชูู ุงูุฃุฐุงูุ ูุณุชุฏุนู `startIqamaCountdown`.

```javascript
// ูุฐุง ุงูู useEffect ูุฑุงูุจ ุงูุชูุงุก ุงูุฃุฐุงู
useEffect(() => {
  const handleAdhanEnd = () => {
    if (currentPhase === 'adhan') {
      startIqamaCountdown(activePrayer);
    }
  };
  audio.addEventListener('ended', handleAdhanEnd);
  return () => audio.removeEventListener('ended', handleAdhanEnd);
}, [currentPhase, activePrayer, startIqamaCountdown]);
```

---

## ๐ฌ ุงูุณููุงุฑูู ุงูุฌุฏูุฏ (ุงููุงูู)

```
1. 3:43:00 โ useEffect ุงูุฃูู ููุชุดู ููุช ุงูุตูุงุฉ
     โ
2. setCurrentPhase('adhan')
     โ
3. useEffect ุงูุซุงูู ููุชุดู ุงูุชุบููุฑ โ ๐ ูุดุบู ุงูุฃุฐุงู
     โ
4. ๐ต ุงูุฃุฐุงู ูุนูู (3-4 ุฏูุงุฆู)
     โ
5. ๐ ุงูุฃุฐุงู ููุชูู
     โ
6. useEffect ุงูุซุงูุซ ูุณูุน ุญุฏุซ 'ended'
     โ
7. โณ ูุณุชุฏุนู startIqamaCountdown
     โ
8. ูุจุฏุฃ ุงูุนุฏ ุงูุชูุงุฒูู!
```

---

## โ ุงููุฒุงูุง

- **ูุตู ุงููุณุคูููุงุช:** ูู `useEffect` ูู ูููุฉ ูุงุญุฏุฉ ููุท.
- **ููุซูููุฉ ุฃุนูู:** ูุง ููุฌุฏ ุชุฏุงุฎู ุจูู ุงูู `event listeners`.
- **ุณูููุฉ ุงูุตูุงูุฉ:** ุงูููุฏ ุฃุตุจุญ ุฃูุซุฑ ูุถูุญุงู.

## ๐ ุงูุณุฌูุงุช ูู Console

```
๐ [PRAYER TIME] โ Prayer time reached for asr at 15:43
๐ [ADHAN] โโโ STARTING ADHAN FOR ASR โโโ
๐ [ADHAN] ๐ต๐ต๐ต ADHAN IS PLAYING NOW! ๐ต๐ต๐ต
...
๐ [ADhan] โ Adhan ended naturally, starting iqama countdown
โณ [IQAMA] Starting iqama countdown for asr
โณ [IQAMA] Countdown duration: 15 minutes
```

---

## โ ุงููุชูุฌุฉ

**ุงูุนุฏ ุงูุชูุงุฒูู ุงูุขู ูุจุฏุฃ ุชููุงุฆูุงู ูุจุดูู ููุซูู ุจุนุฏ ุงูุชูุงุก ุงูุฃุฐุงู.** ๐

---

**ุชุงุฑูุฎ:** 2025-10-11  
**ุงูุฅุตุฏุงุฑ:** 3.4.0 - Reliable Iqama Countdown  
**ุงูุญุงูุฉ:** โ ุชู ุงูุญู
